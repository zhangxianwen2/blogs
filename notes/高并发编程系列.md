## AIO、BIO、NIO 的区别

IO模型的主要分类：

> 同步IO和异步IO

> 阻塞IO和非阻塞IO

同步阻塞（Blocking-IO）称为BIO

同步非阻塞（Non-blocking-IO）称为NIO

异步非阻塞（Asynchronous-non-blocking-IO）称为AIO

### BIO

一个连接一个线程；数据的读取写入必须阻塞在一个线程内等待其完成。在该读取或写入结束前，该线程一直等着啥也不干，等到完成了采取处理下一个读取和写入。

### NIO

一个请求一个线程；线程会轮询所有的读取操作获取其状态然后进行下一步操作，当发现当前操作无读写数据时，就会去服务下一个操作，而不是像BIO那样傻傻的等待一个读写做完(无论有没有实际的读写)再操作下一个。

### AIO

一个有效请求一个线程；线程无需轮询所有读写操作的状态，每个操作完成后会由系统通知响应线程前往处理。类似于给每个读写操作安装了一个呼叫器，完成了就呼叫线程往下执行。

### 同步和异步的区别

同步：发送一个请求，等待返回后再发送下一个请求，同步可以避免脏读和死锁。

异步：发送一个请求，无需等待返回即可发送下一个请求，异步可以提高效率保证并发。

### BIO、NIO、AIO适用场景

BIO适合连接数目比较少并且框架固定的架构，这种方式对服务器资源的要求比较高，并发局限于应用中。是JDK1.4之前唯一的选择。

NIO适合于连接数目比较多且连接时间比较短（轻操作）的架构，如聊天服务器，并发局限于应用中。编程比较复杂。如当前比较火的框架**Netty**就是基于NIO开发的。

AIO适合于连接数目比较多且连接时间比较长（重操作）的架构，如相册服务器，充分调用OS参与并发操作，变成比较复杂。JDK1.7开始支持。

## NIO的核心概念

NIO的核心概念分为三个，分别是**Channel（通道）**、**Buffer（缓冲区）**、**Selector（选择器）** 

### 通道 channel

Channel像一根水管一样，网络数据可以通过它进行数据的读取和写入。

Channel和流不一样，流是单方向移动，而Channel可以用于读也可以写还可以读写同时进行。

### 缓冲区 Buffer

Buffer作为一个对象，其包含一些用于读出或者写入的数据。

在NIO中，所有的数据都是使用Buffer进行处理，实质上，Buffer对象通常是一个字节数组（ByteBuffer），当然它也可以是其他类的数组，如字符缓冲区为Charbuffer等。当然Buffer中不仅仅只有这个数组，它还维护了一些对数据进行结构化访问以及读写位置等信息。

### 选择器 Selector

也被称为多路复用器，Selector的作用是同时监听多个Channel中感兴趣的事情，实现一个线程管理多个Channel，节省了线程切换上下文所消耗的时间。

值得注意的是，Selector只会监控非阻塞的通道。譬如：FileChannel这样的通道因为是阻塞式的，因此无法被监控。

被选择器监听的Channel事件包括以下四种就绪状态：**接收就绪、读取就绪、写入就绪、连接就绪**

## 提问

**问：**以上介绍后，AIO这么多优势，看起来比NIO还好，那为什么好多框架比如Netty使用NIO而不是AIO呢？

**答：**因为Netty主打的是Linux市场，而在Linux中，由于AIO的底层还是使用的是EPOLL，没有很好的实现AIO，所以在性能上并没有什么优势。同时，由于AIO被JDK封装了一层，所以不太容易做自定义的优化。

> 据悉Windows系统对AIO处理得比较好，但是Netty并不着重在Windows上的使用

AIO还有个缺点是接收数据需要预先分配缓存, 而不是NIO那种需要接收时才需要分配缓存, 所以对连接数量非常大但流量小的情况, 内存浪费很多。

正是因为AIO存在这样的问题，所以AIO并不是适用所有的情况，NIO依然在自己擅长的领域占据着重要的位置。

## TPS和QPS

**TPS**：TransactionsPerSecond的缩写，也就是事务数/秒。它是软件测试结果的测量单位。一个事务是指一个客户机向服务器发送请求然后服务器做出反应的过程。客户机在发送请时开始计时，收到服务器响应后结束计时，以此来计算使用的时间和完成的事务个数。

**QPS**：Queries Per Second意思是“每秒查询率”，是一台服务器每秒能够相应的查询次数，是对一个特定的查询服务器在规定时间内所处理流量多少的衡量标准。

TPS是一个动态的值，表示某段时间内的请求量。而QPS则是对一台服务器的评价，表示的是该台服务器在处理查询请求操作中的性能上限

## 如何设计一个高并发系统

https://www.jianshu.com/p/2a35dec61dc6

https://youzhixueyuan.com/how-to-design-double-11-seconds-kill-system.html

